@model ECOM.Data.Cart

<div class="order">
    <div class="order-header d-flex justify-content-between align-items-center">
        <span class="saler">Satıcı: <b>@Model.Seller.Name</b></span>
        <span class="cargo-desc"><b>Kargo Bedava</b></span>
    </div>
    <hr />
    <div class="order-body">
        <input type="checkbox" name="order-is-active" class="order-is-active" data-id="@Model.CartId" checked />
        <img src="~/@Model.Product.ImagePath" alt="Ürün" class="product-image" />
        <div class="order-info">
            <span class="order-name"><b>@Model.Product.Name</b></span>
            <input type="number" name="order-count" class="order-count"
                   value="@Model.Piece" data-id="@Model.CartId" min="1" />
           
            <span class="price">₺@Model.TotalPrice.ToString("F2")</span>
            
            
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Checkbox değişimi
        document.querySelectorAll('.order-is-active').forEach(cb => {
            cb.addEventListener('change', async function () {
                const cartId = this.dataset.id;
                const isActive = this.checked;

                await fetch('/Cart/UpdateStatus', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ cartId, isActive })
                });
            });
        });

        // Adet değişimi
        document.querySelectorAll('.order-count').forEach(input => {
            input.addEventListener('change', async function () {
                const cartId = this.dataset.id;
                const piece = this.value;

                const response =  await fetch('/Cart/UpdateQuantity', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ cartId, piece })
                });

                if (response.ok) {
                    const data = await response.json();
                    const priceElement = this.closest('.order-info').querySelector('.price');
                    priceElement.textContent = `₺${data.totalPrice}`;
                }
            });
        });
    });
</script>